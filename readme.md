# protoc-gen-proto2schema

This is a protoc plugin/standalone tool that can take a FileDescriptor file generated by protoc or be called as a protoc plugin and outputs an aggregated schema that includes all subtypes etc. This aggregated schema format is useful for getting a birds eye view of a schema instead of having to go to buf studio and trying to follow the schema rabbit hole.

## Setup

> [!IMPORTANT]  
> `asdf` is required to be installed before setting up.

Install asdf plugins:
```bash
asdf plugin add golang https://github.com/asdf-community/asdf-golang.git && \
asdf plugin add buf https://github.com/truepay/asdf-buf.git && \
asdf plugin add protoc https://github.com/paxosglobal/asdf-protoc.git;
```

Install asdf dependencies

```bash
asdf install
```

## Building Tool for Local Testing

```bash
go build -o bin/protoc-gen-protoschema cmd/proto2schema/main.go
```

## Standalone Mode

Standalone mode is when the tool is run as a standalone CLI tool and not as a protoc plugin.

To generate a FileDescriptor input file from the example protos in this repo:

```bash
protoc -I="protos" --descriptor_set_out="gen/addressbook.binpb" --include_imports --include_source_info "protos/addressbook.proto" "protos/phonenumber.proto"
```

Run the tool against the example:

```bash
bin/protoc-gen-protoschema --descriptor_set="./gen/addressbook.binpb" --out="./gen/addressbook.fdhschema"
```

## Protoc Plugin Mode

Plugin mode is when the tool is called via `protoc`. In plugin mode, all files passed into protoc will be passed to the plugin.

```bash
protoc -I="protos" --plugin=bin/protoc-gen-protoschema --protoschema_out=./gen "protos/addressbook.proto"
```

## Filtering

Coming soon!
